<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¶€ì‚° AI ì—¬í–‰ ê°€ì´ë“œ</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-blue: #007bff;
            --user-bubble-bg: #0062cc;
            --ai-bubble-bg: #ffffff;
            --bg-color: #f4f7fa;
            --text-color: #333333;
            --favorite-gold: #ffc107;
        }
        * { box-sizing: border-box; }
        body { font-family: 'Noto Sans KR', sans-serif; margin: 0; background-color: var(--bg-color); height: 100vh; display: flex; flex-direction: column; color: var(--text-color); overflow: hidden; }
        
        /* í—¤ë” ë””ìì¸ */
        header { background-color: var(--primary-blue); color: white; padding: 15px 20px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .header-left { display: flex; align-items: center; }
        .header-icon { font-size: 2rem; margin-right: 15px; display: flex; align-items: center; }
        .bot-svg { width: 40px; height: 40px; fill: currentColor; }
        .header-title h1 { margin: 0; font-size: 1.2rem; font-weight: 700; }
        .header-title p { margin: 0; font-size: 0.85rem; opacity: 0.9; }
        
        /* ì¦ê²¨ì°¾ê¸° ë²„íŠ¼ */
        .favorite-btn { background: rgba(255,255,255,0.2); border: none; color: white; padding: 8px 15px; border-radius: 20px; cursor: pointer; display: flex; align-items: center; gap: 5px; font-size: 0.9rem; transition: all 0.3s; }
        .favorite-btn:hover { background: rgba(255,255,255,0.3); }
        .favorite-icon { width: 20px; height: 20px; fill: currentColor; }

        /* íƒ­ ì „í™˜ */
        .tab-container { display: flex; background: white; border-bottom: 2px solid #e0e0e0; }
        .tab { flex: 1; padding: 15px; text-align: center; cursor: pointer; background: white; border: none; font-size: 1rem; font-weight: 500; color: #666; transition: all 0.3s; }
        .tab.active { color: var(--primary-blue); border-bottom: 3px solid var(--primary-blue); }
        
        /* ì±„íŒ…ì°½ ë””ìì¸ */
        .view-container { flex: 1; overflow: hidden; display: flex; flex-direction: column; }
        .chat-view, .favorite-view { flex: 1; overflow-y: auto; padding: 20px; display: none; flex-direction: column; gap: 20px; }
        .chat-view.active, .favorite-view.active { display: flex; }
        
        .message { padding: 15px 18px; border-radius: 18px; max-width: 80%; line-height: 1.6; font-size: 15px; word-break: break-word; position: relative; }
        .user-message { background-color: var(--user-bubble-bg); color: white; align-self: flex-end; border-bottom-right-radius: 4px; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
        .ai-message { background-color: var(--ai-bubble-bg); color: var(--text-color); align-self: flex-start; border-bottom-left-radius: 4px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); border: 1px solid #eef1f5; padding-bottom: 45px; }
        
        /* AI ë©”ì‹œì§€ í•˜ë‹¨ ë²„íŠ¼ */
        .message-actions { position: absolute; bottom: 10px; left: 18px; right: 18px; display: flex; gap: 8px; }
        .action-btn { flex: 1; padding: 8px 12px; border: 1px solid #e0e0e0; background: #f8f9fa; border-radius: 8px; cursor: pointer; font-size: 0.85rem; display: flex; align-items: center; justify-content: center; gap: 5px; transition: all 0.3s; font-family: 'Noto Sans KR', sans-serif; }
        .action-btn:hover { background: #e9ecef; transform: translateY(-1px); }
        .action-btn.favorited { background: #fff3cd; border-color: var(--favorite-gold); color: #856404; }
        .action-btn.favorited:hover { background: #ffe69c; }
        .action-btn svg { width: 16px; height: 16px; fill: currentColor; }
        
        .system-notice { text-align: center; font-size: 0.85rem; color: #666; margin: 10px auto; background: rgba(0,0,0,0.05); padding: 8px 15px; border-radius: 20px; }
        
        /* ì¦ê²¨ì°¾ê¸° ëª©ë¡ */
        .favorite-item { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); border: 1px solid #eef1f5; margin-bottom: 15px; }
        .favorite-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px; }
        .favorite-time { font-size: 0.8rem; color: #999; }
        .favorite-question { font-weight: 600; color: var(--primary-blue); margin-bottom: 10px; font-size: 1rem; }
        .favorite-answer { color: var(--text-color); line-height: 1.6; font-size: 0.95rem; word-break: break-word; }
        .delete-btn { background: #dc3545; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 0.85rem; font-family: 'Noto Sans KR', sans-serif; transition: background 0.3s; }
        .delete-btn:hover { background: #c82333; }
        .empty-favorites { text-align: center; padding: 60px 20px; color: #999; }
        .empty-favorites svg { width: 80px; height: 80px; fill: #ddd; margin-bottom: 20px; }
        
        /* ì…ë ¥ì°½ ë””ìì¸ */
        .input-area { background: #ffffff; padding: 15px; box-shadow: 0 -2px 10px rgba(0,0,0,0.05); display: flex; gap: 10px; align-items: center; flex-shrink: 0; transition: opacity 0.3s; }
        .input-area.hidden { display: none; }
        input { flex: 1; padding: 14px 20px; border: 1px solid #e0e0e0; border-radius: 30px; outline: none; font-size: 16px; background-color: #f8f9fa; font-family: 'Noto Sans KR', sans-serif; }
        input:focus { border-color: var(--primary-blue); background-color: #fff; }
        
        .send-btn { width: 50px; height: 50px; background-color: var(--primary-blue); color: white; border: none; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .send-btn:disabled { background-color: #ccc; cursor: not-allowed; }
        .send-btn:not(:disabled):hover { background-color: #0056b3; }
        .send-icon-svg { width: 24px; height: 24px; fill: currentColor; margin-left: -2px; }

        .loading-dots:after { content: ' .'; animation: dots 1s steps(5, end) infinite; }
        @keyframes dots { 0%, 20% { content: ' .'; } 40% { content: ' ..'; } 60% { content: ' ...'; } 80%, 100% { content: ''; } }
        
        /* ì›¹ ë¸Œë¼ìš°ì € ìµœì í™” */
        @media (min-width: 768px) {
            .chat-view, .favorite-view { max-width: 800px; margin: 0 auto; width: 100%; }
            .input-area { max-width: 800px; margin: 0 auto; width: 100%; }
        }
        
        /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ë§ (ì›¹) */
        .chat-view::-webkit-scrollbar, .favorite-view::-webkit-scrollbar { width: 8px; }
        .chat-view::-webkit-scrollbar-track, .favorite-view::-webkit-scrollbar-track { background: #f1f1f1; }
        .chat-view::-webkit-scrollbar-thumb, .favorite-view::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        .chat-view::-webkit-scrollbar-thumb:hover, .favorite-view::-webkit-scrollbar-thumb:hover { background: #555; }
    </style>
</head>
<body>
    <header>
        <div class="header-left">
            <div class="header-icon">
                <svg class="bot-svg" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2M7.5 13a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3m9 0a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3m-4.5 0a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3"/></svg>
            </div>
            <div class="header-title">
                <h1>ë¶€ì‚° ì—¬í–‰ ê°€ì´ë“œ</h1>
                <p>Your AI travel companion</p>
            </div>
        </div>
        <button class="favorite-btn" onclick="showFavorites()">
            <svg class="favorite-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
            <span id="favoriteCount">0</span>
        </button>
    </header>

    <div class="tab-container">
        <button class="tab active" onclick="switchTab('chat')">ì±„íŒ…</button>
        <button class="tab" onclick="switchTab('favorites')">ì¦ê²¨ì°¾ê¸°</button>
    </div>

    <div class="view-container">
        <div class="chat-view active" id="chatView">
            <div class="message ai-message">
                ë°˜ê°‘ìŠµë‹ˆë‹¤! ğŸ‘‹<br>
                ë¶€ì‚°ì˜ <b>[ëª…ì†Œ, ë§›ì§‘, ì¶•ì œ]</b> ë°ì´í„°ë¥¼ ëª¨ìœ¼ê³  ìˆìŠµë‹ˆë‹¤.<br>
                ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”!
            </div>
        </div>

        <div class="favorite-view" id="favoriteView">
            <div class="empty-favorites">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                <p>ì•„ì§ ì¦ê²¨ì°¾ê¸°í•œ ì¶”ì²œì´ ì—†ìŠµë‹ˆë‹¤.<br>AIì˜ ì¶”ì²œì„ ì €ì¥í•´ë³´ì„¸ìš”!</p>
            </div>
        </div>
    </div>

    <div class="input-area">
        <input type="text" id="userInput" placeholder="ë°ì´í„° ë¡œë”© ì¤‘..." disabled onkeypress="handleEnter(event)">
        <button id="sendBtn" class="send-btn" onclick="sendMessage()" disabled>
            <svg class="send-icon-svg" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
        </button>
    </div>

    <script>
        // â–¼â–¼â–¼ [ì¤‘ìš”] ì—¬ê¸°ì— ì•„ê¹Œ ë³µì‚¬í•œ 'AIza...' ë¡œ ì‹œì‘í•˜ëŠ” ì§„ì§œ í‚¤ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”! â–¼â–¼â–¼
        const GEMINI_API_KEY = "".trim();
        
        // â–¼â–¼â–¼ ê³µê³µë°ì´í„° í‚¤ëŠ” ê·¸ëŒ€ë¡œ ë‘ì„¸ìš” â–¼â–¼â–¼
        const DATA_GO_KR_KEY = "".trim(); 

        let allBusanData = [];
        let favorites = JSON.parse(localStorage.getItem('busanFavorites') || '[]');
        let currentQuestion = '';

        window.onload = async function() {
            await fetchAllData();
            updateFavoriteCount();
            renderFavorites();
        };

        async function fetchAllData() {
            const input = document.getElementById('userInput');
            const btn = document.getElementById('sendBtn');

            try {
                const baseUrl = "https://apis.data.go.kr/6260000";
                const commonParams = `serviceKey=${encodeURIComponent(DATA_GO_KR_KEY)}&pageNo=1&numOfRows=30&resultType=json`;

                const [attractionRes, foodRes, festivalRes] = await Promise.all([
                    fetch(`${baseUrl}/AttractionService/getAttractionKr?${commonParams}`),
                    fetch(`${baseUrl}/FoodService/getFoodKr?${commonParams}`),
                    fetch(`${baseUrl}/FestivalService/getFestivalKr?${commonParams}`)
                ]);

                const attractionJson = await attractionRes.json();
                const foodJson = await foodRes.json();
                const festivalJson = await festivalRes.json();

                const attractions = (attractionJson.getAttractionKr?.item || []).map(item => ({
                    category: "ê´€ê´‘ì§€",
                    name: item.MAIN_TITLE,
                    location: item.GUGUN_NM,
                    desc: item.ITEMCNTNCN
                }));

                const foods = (foodJson.getFoodKr?.item || []).map(item => ({
                    category: "ë§›ì§‘",
                    name: item.MAIN_TITLE,
                    location: item.GUGUN_NM,
                    desc: `ëŒ€í‘œë©”ë‰´: ${item.RPRSNTV_MENU}, ${item.ITEMCNTNCN}`
                }));

                const festivals = (festivalJson.getFestivalKr?.item || []).map(item => ({
                    category: "ì¶•ì œ",
                    name: item.MAIN_TITLE,
                    location: item.GUGUN_NM,
                    desc: `ê¸°ê°„: ${item.USAGE_DAY_WEEK_AND_TIME}, ${item.ITEMCNTNCN}`
                }));

                allBusanData = [...attractions, ...foods, ...festivals];

                appendSystemMessage(`âœ… ë°ì´í„° í†µí•© ì™„ë£Œ! (ì´ ${allBusanData.length}ê°œ íƒ‘ì¬)`);
                appendMessage("ë¶€ì‚°ì˜ ëª¨ë“  ì¦ê¸¸ê±°ë¦¬ê°€ ì¤€ë¹„ëì–´ìš”! ì§ˆë¬¸í•´ ì£¼ì„¸ìš”.", 'ai-message', false);
                
                input.disabled = false;
                btn.disabled = false;
                input.placeholder = "ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”...";
                input.focus();

            } catch (error) {
                console.error("ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:", error);
                appendSystemMessage(`âŒ ë°ì´í„° ë¡œë”© ì‹¤íŒ¨. ê³µê³µë°ì´í„° í‚¤ë¥¼ í™•ì¸í•˜ì„¸ìš”.`);
            }
        }

        async function sendMessage() {
            const inputField = document.getElementById('userInput');
            const message = inputField.value.trim();
            if (!message) return;

            currentQuestion = message;
            appendMessage(message, 'user-message', false);
            inputField.value = '';
            
            const loadingId = appendMessage("AIê°€ ì—¬í–‰ ì½”ìŠ¤ë¥¼ ê³„íš ì¤‘ì…ë‹ˆë‹¤<span class='loading-dots'></span>", 'ai-message', false);

            try {
                const cleanKey = GEMINI_API_KEY.trim();

                const prompt = `
                    [ì—­í• ]
                    ë„ˆëŠ” ë¶€ì‚° ì—¬í–‰ ì „ë¬¸ ê°€ì´ë“œ AIì•¼.
                    
                    [ì°¸ê³  ë°ì´í„°]
                    ${JSON.stringify(allBusanData).slice(0, 15000)} 
                    
                    [ì‚¬ìš©ì ì§ˆë¬¸]
                    ${message}
                    
                    [ì§€ì‹œì‚¬í•­]
                    ê´€ê´‘ì§€, ë§›ì§‘, ì¶•ì œ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì¶”ì²œí•´ì£¼ê³  ì¹œì ˆí•˜ê²Œ ë‹µí•´ì¤˜.
                `;

                const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${cleanKey}`;

                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`API ì˜¤ë¥˜ (${response.status}): ${errorData.error?.message}`);
                }

                const data = await response.json();
                
                if (!data.candidates || data.candidates.length === 0) {
                    throw new Error("AI ë‹µë³€ ìƒì„± ì‹¤íŒ¨ (ì•ˆì „ ì •ì±… ë“±)");
                }

                const aiResponse = data.candidates[0].content.parts[0].text;
                
                const loadingElement = document.getElementById(loadingId);
                if (loadingElement) loadingElement.remove();
                
                appendMessage(aiResponse, 'ai-message', true, aiResponse);

            } catch (error) {
                console.error(error);
                const loadingElement = document.getElementById(loadingId);
                if (loadingElement) {
                    loadingElement.innerHTML = `<span style="color:red; font-weight:bold;">âŒ ì˜¤ë¥˜</span><br><small>${error.message}</small>`;
                }
            }
        }

        function appendMessage(text, className, showActions = false, fullAnswer = '') {
            const chatBox = document.getElementById('chatView');
            const msgDiv = document.createElement('div');
            msgDiv.className = `message ${className}`;
            msgDiv.innerHTML = text.replace(/\n/g, '<br>');
            msgDiv.id = 'msg-' + Date.now();
            
            if (showActions && className === 'ai-message') {
                const isFavorited = favorites.some(f => f.answer === fullAnswer);
                const actionsDiv = document.createElement('div');
                actionsDiv.className = 'message-actions';
                actionsDiv.innerHTML = `
                    <button class="action-btn ${isFavorited ? 'favorited' : ''}" onclick="toggleFavorite('${msgDiv.id}', \`${escapeHtml(fullAnswer)}\`)">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                        </svg>
                        ${isFavorited ? 'ì¦ê²¨ì°¾ê¸°ë¨' : 'ì¦ê²¨ì°¾ê¸°'}
                    </button>
                `;
                msgDiv.appendChild(actionsDiv);
            }
            
            chatBox.appendChild(msgDiv);
            chatBox.scrollTop = chatBox.scrollHeight;
            return msgDiv.id;
        }

        function appendSystemMessage(text) {
            const chatBox = document.getElementById('chatView');
            const msgDiv = document.createElement('div');
            msgDiv.className = 'system-notice';
            msgDiv.innerText = text;
            chatBox.appendChild(msgDiv);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        function toggleFavorite(msgId, answer) {
            const unescapedAnswer = unescapeHtml(answer);
            const existingIndex = favorites.findIndex(f => f.answer === unescapedAnswer);
            
            if (existingIndex >= 0) {
                favorites.splice(existingIndex, 1);
            } else {
                favorites.push({
                    id: Date.now(),
                    question: currentQuestion,
                    answer: unescapedAnswer,
                    timestamp: new Date().toISOString()
                });
            }
            
            localStorage.setItem('busanFavorites', JSON.stringify(favorites));
            updateFavoriteCount();
            renderFavorites();
            
            const msgElement = document.getElementById(msgId);
            if (msgElement) {
                const btn = msgElement.querySelector('.action-btn');
                const isFavorited = favorites.some(f => f.answer === unescapedAnswer);
                btn.classList.toggle('favorited', isFavorited);
                btn.innerHTML = `
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                    </svg>
                    ${isFavorited ? 'ì¦ê²¨ì°¾ê¸°ë¨' : 'ì¦ê²¨ì°¾ê¸°'}
                `;
            }
        }

        function deleteFavorite(id) {
            if (confirm('ì´ ì¦ê²¨ì°¾ê¸°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                favorites = favorites.filter(f => f.id !== id);
                localStorage.setItem('busanFavorites', JSON.stringify(favorites));
                updateFavoriteCount();
                renderFavorites();
            }
        }

        function updateFavoriteCount() {
            document.getElementById('favoriteCount').textContent = favorites.length;
        }

        function renderFavorites() {
            const favoriteView = document.getElementById('favoriteView');
            
            if (favorites.length === 0) {
                favoriteView.innerHTML = `
                    <div class="empty-favorites">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                        <p>ì•„ì§ ì¦ê²¨ì°¾ê¸°í•œ ì¶”ì²œì´ ì—†ìŠµë‹ˆë‹¤.<br>AIì˜ ì¶”ì²œì„ ì €ì¥í•´ë³´ì„¸ìš”!</p>
                    </div>
                `;
                return;
            }
            
            favoriteView.innerHTML = favorites.slice().reverse().map(fav => `
                <div class="favorite-item">
                    <div class="favorite-header">
                        <div class="favorite-time">${formatDate(fav.timestamp)}</div>
                        <button class="delete-btn" onclick="deleteFavorite(${fav.id})">ì‚­ì œ</button>
                    </div>
                    <div class="favorite-question">Q: ${escapeHtml(fav.question)}</div>
                    <div class="favorite-answer">${escapeHtml(fav.answer).replace(/\n/g, '<br>')}</div>
                </div>
            `).join('');
        }

        function switchTab(tab) {
            const inputArea = document.querySelector('.input-area');
            
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.chat-view, .favorite-view').forEach(v => v.classList.remove('active'));
            
            if (tab === 'chat') {
                document.querySelectorAll('.tab')[0].classList.add('active');
                document.getElementById('chatView').classList.add('active');
                inputArea.classList.remove('hidden');
            } else {
                document.querySelectorAll('.tab')[1].classList.add('active');
                document.getElementById('favoriteView').classList.add('active');
                inputArea.classList.add('hidden');
                renderFavorites();
            }
        }

        function showFavorites() {
            switchTab('favorites');
        }

        function formatDate(isoString) {
            const date = new Date(isoString);
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const hours = date.getHours();
            const minutes = String(date.getMinutes()).padStart(2, '0');
            return `${month}ì›” ${day}ì¼ ${hours}:${minutes}`;
        }

        function escapeHtml(text) {
            return text.replace(/[&<>"']/g, function(m) {
                return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m];
            });
        }

        function unescapeHtml(text) {
            return text.replace(/&amp;|&lt;|&gt;|&quot;|&#039;/g, function(m) {
                return {'&amp;':'&','&lt;':'<','&gt;':'>','&quot;':'"','&#039;':"'"}[m];
            });
        }

        function handleEnter(e) {
            if (e.key === 'Enter') sendMessage();
        }
    </script>
</body>
</html>
